<div class="container">
  <h1 class="mb-4">Dashboard</h1>

  <!-- Summary Cards -->
  <div class="row mb-4">
    <div class="col-md-3">
      <div class="card text-white bg-primary">
        <div class="card-body">
          <h5 class="card-title">Total Expenses (This Month)</h5>
          <h2 class="card-text">
            ₦<%= totalMonthlyExpenses.toLocaleString() %>
          </h2>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card text-white bg-success">
        <div class="card-body">
          <h5 class="card-title">Budget Remaining</h5>
          <h2 class="card-text">₦<%= budgetRemaining.toLocaleString() %></h2>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card text-white bg-warning">
        <div class="card-body">
          <h5 class="card-title">Highest Category</h5>
          <h2 class="card-text"><%= highestCategory.name %></h2>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card text-white bg-info">
        <div class="card-body">
          <h5 class="card-title">Total Categories</h5>
          <h2 class="card-text"><%= categoriesCount %></h2>
        </div>
      </div>
    </div>
  </div>

  <!-- Charts Row -->
  <div class="row mb-4">
    <div class="col-md-6">
      <div class="card">
        <div class="card-header">Monthly Expense Trend</div>
        <div class="card-body">
          <canvas id="monthlyExpenseChart"></canvas>
        </div>
      </div>
    </div>
    <div class="col-md-6">
      <div class="card">
        <div class="card-header">Expense by Category</div>
        <div class="card-body">
          <canvas id="categoryExpenseChart"></canvas>
        </div>
      </div>
    </div>
  </div>

  <!-- Recent Expenses -->
  <div class="row">
    <div class="col-12">
      <div class="card">
        <div
          class="card-header d-flex justify-content-between align-items-center"
        >
          <span>Recent Expenses</span>
          <a href="/expenses/add" class="btn btn-sm btn-primary">Add New</a>
        </div>
        <div class="card-body">
          <% if (recentExpenses.length > 0) { %>
          <div class="table-responsive">
            <table class="table table-striped table-hover">
              <thead>
                <tr>
                  <th>Date</th>
                  <th>Description</th>
                  <th>Category</th>
                  <th>Amount</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                <% recentExpenses.forEach(expense => { %>
                <tr>
                  <td><%= new Date(expense.date).toLocaleDateString() %></td>
                  <td><%= expense.description %></td>
                  <td>
                    <span
                      class="badge"
                      style="background-color: <%= expense.category.color %>"
                      ><%= expense.category.name %></span
                    >
                  </td>
                  <td>₦<%= expense.amount.toLocaleString() %></td>
                  <td>
                    <a
                      href="/expenses/<%= expense._id %>"
                      class="btn btn-sm btn-info"
                      ><i class="fas fa-eye"></i
                    ></a>
                    <a
                      href="/expenses/edit/<%= expense._id %>"
                      class="btn btn-sm btn-warning"
                      ><i class="fas fa-edit"></i
                    ></a>
                    <form
                      action="/expenses/<%= expense._id %>?_method=DELETE"
                      method="POST"
                      class="d-inline"
                    >
                      <button
                        type="submit"
                        class="btn btn-sm btn-danger"
                        onclick="return confirm('Are you sure?')"
                      >
                        <i class="fas fa-trash"></i>
                      </button>
                    </form>
                  </td>
                </tr>
                <% }) %>
              </tbody>
            </table>
          </div>
          <% } else { %>
          <p class="text-center">
            No expenses found.
            <a href="/expenses/add">Add your first expense</a>.
          </p>
          <% } %>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  // Monthly Expense Chart
  const monthlyCtx = document.getElementById('monthlyExpenseChart').getContext('2d');
  const monthlyExpenseChart = new Chart(monthlyCtx, {
      type: 'line',
      data: {
          labels: <%- JSON.stringify(monthlyLabels) %>,
          datasets: [{
              label: 'Monthly Expenses',
              data: <%- JSON.stringify(monthlyData) %>,
              backgroundColor: 'rgba(54, 162, 235, 0.2)',
              borderColor: 'rgba(54, 162, 235, 1)',
              borderWidth: 1
          }]
      },
      options: {
          scales: {
              y: {
                  beginAtZero: true
              }
          }
      }
  });

  // Category Expense Chart
  const categoryCtx = document.getElementById('categoryExpenseChart').getContext('2d');
  const categoryExpenseChart = new Chart(categoryCtx, {
      type: 'doughnut',
      data: {
          labels: <%- JSON.stringify(categoryLabels) %>,
          datasets: [{
              label: 'Expenses by Category',
              data: <%- JSON.stringify(categoryData) %>,
              backgroundColor: <%- JSON.stringify(categoryColors) %>,
              borderWidth: 1
          }]
      }
  });
</script>
